(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,r,n){return(r=function(e){var r=function(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===t(r)?r:String(r)}(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function i(e){e.classList.add("popup_opened")}function c(e){e.classList.remove("popup_opened")}e.d({},{i8:()=>x,jL:()=>_,wi:()=>k,FH:()=>v,OP:()=>H,iW:()=>z,EG:()=>h,ER:()=>I,Ft:()=>L,gD:()=>P,NT:()=>A,HK:()=>N,RU:()=>J,JO:()=>D,x$:()=>j,Jx:()=>F,Kg:()=>q,LT:()=>U,BU:()=>M,rC:()=>K});var u=function(e,t){var r=e.querySelector(".".concat(t.id,"-input-error"));t.classList.remove(z.inputErrorClass),r.classList.remove(z.errorClass),r.textContent=""};function a(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r.inactiveButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.disabled=!0)}function l(e){if(e.target.classList.contains("element__trash-button")){var t=e.target.closest(".element");fetch(v+"cards/"+t.id,{method:"DELETE",headers:_}).then((function(e){return e.ok?e.json():Promise.reject(e.statusText)})).then((function(){t.remove()})).catch((function(e){return console.log("Ошибка: ".concat(e))}))}}function s(e){var t=e.target,r=e.target.closest(".element"),n=r.querySelector(".element__like-number");t.classList.contains("element__button_active")?fetch(v+"cards/likes/".concat(r.id),{method:"DELETE",headers:_}).then((function(e){return e.ok?e.json():Promise.reject(e.statusText)})).then((function(e){n.textContent=e.likes.length,t.classList.remove("element__button_active")})).catch((function(e){console.log(e)})):fetch(v+"cards/likes/".concat(r.id),{method:"PUT",headers:_}).then((function(e){return e.ok?e.json():Promise.reject(e.statusText)})).then((function(e){n.textContent=e.likes.length,t.classList.add("element__button_active")})).catch((function(e){console.log(e)}))}function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){m(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==p(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===p(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e){var t=e.name,r=e.link,n=e.likes,o=e.cardId,c=e.owner,u=e.isLiked,a=H.content.cloneNode(!0).querySelector(".element"),p=a.querySelector(".element__title"),f=a.querySelector(".element__image"),d=a.querySelector(".element__button"),m=a.querySelector(".element__trash-button"),y=a.querySelector(".element__like-number");return a.id=o,p.textContent=t,f.src=r,f.alt=t,y.textContent=n,c?m.addEventListener("click",l):m.remove(),u&&d.classList.add("element__button_active"),d.addEventListener("click",s),f.addEventListener("click",(function(e){e.stopPropagation(),function(e){var t=e.querySelector(".element__title").textContent,r=e.querySelector(".element__image").src;N.src=r,N.alt=t,J.textContent=t,i(A)}(a)})),a}var v="https://nomoreparties.co/v1/apf-cohort-202/",_={authorization:"7a6d984f-ee47-48a3-8ee3-bb2675ba62c9"},b=document.querySelector(".page"),S=b.querySelector(".profile__edit-button"),h=b.querySelector("#edit"),g=h.querySelector(".popup__close-button"),q=b.querySelector("#popupName"),j=b.querySelector("#popupDescription"),O=h.querySelector(".popup__form"),k=document.querySelector(".profile__avatar"),E=document.querySelector(".profile__avatar-wrapper");console.log(E,k);var L=b.querySelector("#avatar"),P=(L.querySelector(".popup__form"),L.querySelector("#popupAvatarLink")),C=L.querySelector(".popup__close-button"),w=b.querySelector(".profile__add-button"),x=b.querySelector("#add"),T=x.querySelector(".popup__close-button"),D=x.querySelector(".popup__form"),A=b.querySelector("#photo"),B=A.querySelector(".popup__close-button"),N=A.querySelector(".popup__image"),J=A.querySelector(".popup__image-text"),H=document.querySelector("#card-template"),I=document.querySelector(".elements__list"),U=document.querySelector("#popupTitle"),F=document.querySelector("#popupImageLink"),K=b.querySelector(".profile__name"),M=b.querySelector(".profile__description"),R=(b.querySelector(".profile__avatar"),""),z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};fetch(v+"users/me",{headers:_}).then((function(e){return e.json()})).then((function(e){K.textContent=e.name,M.textContent=e.about,R=e._id,k.src=e.avatar})),fetch(v+"cards",{headers:_}).then((function(e){return e.json()})).then((function(e){e.forEach((function(e){var t=e.likes.some((function(e){return e._id===R})),r=y({name:e.name,link:e.link,likes:e.likes.length,cardId:e._id,owner:e.owner._id===R,isLiked:t});I.appendChild(r)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);a(r,n,t),r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,r){var n=t.dataset.errorText,o=t.validity.valid;t.setCustomValidity(t.validity.patternMismatch?n:""),o?u(e,t):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-input-error"));t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(e,t,t.validationMessage,r)}(e,o,t),a(r,n,t)}))}))}(t,e)}))}(z),S.addEventListener("click",(function(e){e.stopPropagation(),q.value=K.textContent,j.value=M.textContent,i(h)})),w.addEventListener("click",(function(e){e.stopPropagation(),i(x)})),E.addEventListener("click",(function(e){e.stopPropagation(),P.value="",i(L)})),g.addEventListener("click",(function(){return c(h)})),T.addEventListener("click",(function(){return c(x)})),B.addEventListener("click",(function(){return c(A)})),C.addEventListener("click",(function(){return c(L)})),O.addEventListener("submit",(function(e){e.preventDefault(),console.log("save"),h.querySelector(".popup__submit").value="Сохранение...",fetch(v+"users/me",{method:"PATCH",headers:n(n({},_),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:q.value,about:j.value})}).then((function(e){return e.json()})).then((function(e){K.textContent=e.name,M.textContent=e.about})).finally((function(){c(h),h.querySelector(".popup__submit").value="Сохранить"}))})),D.addEventListener("submit",(function(e){e.preventDefault(),x.querySelector(".popup__submit").value="Сохранение...",fetch(v+"cards",{method:"POST",headers:d(d({},_),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:U.value,link:F.value})}).then((function(e){return e.json()})).then((function(e){var t=y({name:e.name,link:e.link,likes:0,cardId:e.id,owner:!0});I.insertBefore(t,I.firstChild)})).finally((function(){c(x),D.reset(),x.querySelector(".popup__submit").value="Сохранить"}))})),L.addEventListener("submit",(function(e){e.preventDefault(),L.querySelector(".popup__submit").value="Сохранение...",fetch(v+"users/me/avatar",{method:"PATCH",headers:n(n({},_),{},{"Content-Type":"application/json"}),body:JSON.stringify({avatar:P.value})}).then((function(e){return e.json()})).then((function(e){k.src=e.avatar})).finally((function(){c(L),L.querySelector(".popup__submit").value="Сохранить"}))})),document.addEventListener("keydown",(function(e){var t=document.querySelector(".popup_opened");"Escape"===e.key&&c(t)})),document.addEventListener("click",(function(e){var t=document.querySelector(".popup_opened");!t||e.target.closest(".popup__container")||e.target.closest(".popup__image-container")||c(t)}))})();